# ============================================
# AS-03 Backend - Environment Configuration
# ============================================
# Copy this file to .env and update with your values
# DO NOT commit .env to version control!

# ============================================
# Application Settings
# ============================================
ENV=dev
# Options: dev, prod
# - dev: Allows all CORS origins, less strict validation
# - prod: Requires HTTPS, strict CORS, secure cookies

SESSION_SECRET_KEY=change-me-in-production-use-strong-random-key
# CRITICAL: Use a strong random key in production (min 32 chars)
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"

# ============================================
# Keycloak Configuration
# ============================================
KEYCLOAK_SERVER_URL=http://localhost:8080
# Base URL of your Keycloak server (no trailing slash)
# Production example: https://auth.example.com

KEYCLOAK_REALM=demo
# Keycloak realm name

KEYCLOAK_CLIENT_ID=fastapi-app
# OAuth client ID (created in Keycloak)

KEYCLOAK_CLIENT_SECRET=your-client-secret-here
# OAuth client secret (get from Keycloak admin console)
# Navigate to: Clients -> Your Client -> Credentials tab

# ============================================
# Keycloak Admin API (Optional)
# ============================================
# Required for admin endpoints (user sync, group management)
KEYCLOAK_ADMIN_CLIENT_ID=admin-cli
KEYCLOAK_ADMIN_CLIENT_SECRET=your-admin-secret-here

# ============================================
# Cache TTL Settings (in seconds)
# ============================================
# Fine-tune caching behavior for performance vs freshness

# JWKS Cache - Public keys for JWT validation
JWKS_CACHE_TTL=600
# Default: 600 (10 minutes)
# JWKS keys rarely change, safe to cache longer
JWKS_CACHE_MAXSIZE=2
# Default: 2 (only need current JWKS)

# Admin Token Cache - For Keycloak Admin API calls
ADMIN_TOKEN_CACHE_TTL=300
# Default: 300 (5 minutes)
# Admin tokens expire quickly, don't cache too long
ADMIN_TOKEN_CACHE_MAXSIZE=1
# Default: 1 (only one admin token needed)

# User Info Cache - User profile data
USER_INFO_CACHE_TTL=300
# Default: 300 (5 minutes)
# User info can change (roles, email), moderate TTL
USER_INFO_CACHE_MAXSIZE=100
# Default: 100 (cache up to 100 users)

# Group Cache - Keycloak group hierarchy
GROUP_CACHE_TTL=600
# Default: 600 (10 minutes)
# Group structure changes infrequently, safe to cache longer
GROUP_CACHE_MAXSIZE=50
# Default: 50 (cache up to 50 groups)

# ============================================
# Optional Overrides
# ============================================
# KEYCLOAK_METADATA_URL=https://auth.example.com/realms/demo/.well-known/openid-configuration
# Override auto-generated metadata URL if needed

# ============================================
# Production Deployment Notes
# ============================================
# 1. Use HTTPS for KEYCLOAK_SERVER_URL
# 2. Set ENV=prod
# 3. Generate strong SESSION_SECRET_KEY (32+ chars)
# 4. Store secrets in a secret manager (AWS Secrets Manager, Vault, K8s Secrets)
# 5. Configure CORS origins in app/main.py
# 6. Enable HTTPS-only cookies (automatic when ENV=prod)
# 7. Use Gunicorn with multiple workers for production
# 8. Set up monitoring and logging
# 9. Configure health check endpoints for K8s/Docker
# 10. Review and adjust cache TTL values based on your use case
